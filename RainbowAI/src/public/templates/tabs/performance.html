    <!-- Shared Date Range Filter -->
    <div class="mb-4 bg-white rounded-2xl border p-4">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-neutral-800">Performance Analytics</h2>
          <p class="text-sm text-neutral-500"><span class="section-tip" data-tip="Date range applies only to Feedback Analytics (left). Intent Accuracy (right) uses all stored predictions with no date filter.">User feedback satisfaction and intent classification accuracy</span></p>
        </div>
        <div class="flex flex-wrap gap-2">
          <input type="date" id="performance-date-from" class="text-sm border rounded-lg px-3 py-2">
          <input type="date" id="performance-date-to" class="text-sm border rounded-lg px-3 py-2">
          <button onclick="refreshPerformanceData()" class="text-sm bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-lg transition font-medium" title="Reload feedback analytics for the selected date range">
            Apply Filter
          </button>
        </div>
      </div>
    </div>

    <!-- Feedback Settings Panel (Collapsible) -->
    <div class="mb-4 bg-white rounded-2xl border overflow-hidden">
      <button onclick="toggleFeedbackSettings()" class="w-full flex items-center justify-between px-4 py-3 bg-neutral-50 hover:bg-neutral-100 transition">
        <div class="flex items-center gap-2">
          <span class="text-base">&#9881;</span>
          <h3 class="font-semibold text-neutral-700 text-sm">Feedback Settings</h3>
          <span id="fb-settings-status" class="text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-700">Enabled</span>
        </div>
        <svg id="fb-settings-chevron" class="w-4 h-4 text-neutral-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </button>

      <div id="fb-settings-panel" class="hidden border-t">
        <!-- Loading -->
        <div id="fb-settings-loading" class="p-6 text-center">
          <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-primary-500 border-t-transparent"></div>
          <div class="text-sm text-neutral-500 mt-2">Loading feedback settings...</div>
        </div>

        <!-- Settings Form -->
        <div id="fb-settings-form" class="hidden p-4 space-y-4">
          <!-- Row 1: Toggle + Frequency + Timeout -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <!-- Enable/Disable -->
            <div>
              <label class="block text-xs font-medium text-neutral-600 mb-1">Feedback Collection</label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" id="fb-enabled" class="w-4 h-4 rounded border-neutral-300 text-primary-500 focus:ring-primary-500" onchange="onFeedbackSettingChange()">
                <span class="text-sm text-neutral-700">Ask "Was this helpful?"</span>
              </label>
            </div>
            <!-- Frequency -->
            <div>
              <label for="fb-frequency" class="block text-xs font-medium text-neutral-600 mb-1">Ask Every (minutes)</label>
              <input type="number" id="fb-frequency" min="1" max="1440" class="w-full text-sm border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500" onchange="onFeedbackSettingChange()">
              <div class="text-xs text-neutral-400 mt-0.5">Min gap between asks per user</div>
            </div>
            <!-- Timeout -->
            <div>
              <label for="fb-timeout" class="block text-xs font-medium text-neutral-600 mb-1">Response Timeout (minutes)</label>
              <input type="number" id="fb-timeout" min="1" max="10" class="w-full text-sm border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500" onchange="onFeedbackSettingChange()">
              <div class="text-xs text-neutral-400 mt-0.5">Wait time before giving up</div>
            </div>
          </div>

          <!-- Row 2: Skip Intents -->
          <div>
            <label class="block text-xs font-medium text-neutral-600 mb-2" title="Checked intents will never prompt guests with 'Was this helpful?' ‚Äî useful for greetings, thanks, and other intents where feedback adds no value">Skip Feedback For (don't ask for these intents)</label>
            <div id="fb-skip-intents" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-1.5"></div>
          </div>

          <!-- Row 3: Prompts -->
          <div>
            <label class="block text-xs font-medium text-neutral-600 mb-2">Feedback Prompt Messages</label>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
              <div>
                <div class="text-xs text-neutral-500 mb-1">English</div>
                <input type="text" id="fb-prompt-en" class="w-full text-sm border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500" onchange="onFeedbackSettingChange()">
              </div>
              <div>
                <div class="text-xs text-neutral-500 mb-1">Malay</div>
                <input type="text" id="fb-prompt-ms" class="w-full text-sm border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500" onchange="onFeedbackSettingChange()">
              </div>
              <div>
                <div class="text-xs text-neutral-500 mb-1">Chinese</div>
                <input type="text" id="fb-prompt-zh" class="w-full text-sm border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary-500 focus:border-primary-500" onchange="onFeedbackSettingChange()">
              </div>
            </div>
          </div>

          <!-- Save Button -->
          <div class="flex items-center justify-between pt-2 border-t">
            <div id="fb-settings-dirty" class="hidden text-xs text-amber-600 font-medium">Unsaved changes</div>
            <button id="fb-save-btn" onclick="saveFeedbackSettings()" class="ml-auto text-sm bg-primary-500 hover:bg-primary-600 disabled:bg-neutral-300 disabled:cursor-not-allowed text-white px-4 py-2 rounded-lg transition font-medium" disabled>
              Save Settings
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Two-Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <!-- LEFT COLUMN: Feedback Stats -->
      <div class="space-y-4">
        <div class="flex items-center justify-between">
          <h3 class="text-base font-semibold text-neutral-700">Feedback Analytics</h3>
          <button onclick="refreshFeedbackStats()" class="text-xs bg-neutral-100 hover:bg-neutral-200 text-neutral-700 px-3 py-1.5 rounded-lg transition font-medium">
            Refresh
          </button>
        </div>

        <!-- Overall Stats Cards -->
        <div id="feedback-overall-stats" class="grid grid-cols-2 gap-3">
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="feedback-total" class="text-2xl font-bold text-neutral-800">0</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Count of all &quot;Was this helpful?&quot; responses in the selected date range. Stored in rainbow_feedback; each row = one guest rating."><span class="tip-icon">‚Ñπ</span> Total Feedback</span></div>
          </div>
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="feedback-thumbs-up" class="text-2xl font-bold text-green-600">0</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Number of responses where the guest tapped thumbs up (rating = 1)."><span class="tip-icon">‚Ñπ</span> üëç Thumbs Up</span></div>
          </div>
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="feedback-thumbs-down" class="text-2xl font-bold text-red-500">0</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Number of responses where the guest tapped thumbs down (rating = -1)."><span class="tip-icon">‚Ñπ</span> üëé Thumbs Down</span></div>
          </div>
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="feedback-satisfaction" class="text-2xl font-bold text-primary-500">0%</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="(Thumbs up √∑ Total feedback) √ó 100. Only counts rows where the guest gave feedback."><span class="tip-icon">‚Ñπ</span> Satisfaction Rate</span></div>
          </div>
        </div>

        <!-- By Intent Table -->
        <div class="bg-white rounded-2xl border overflow-hidden">
          <div class="bg-neutral-50 px-4 py-3 border-b">
            <h4 class="font-semibold text-neutral-700 text-sm">Feedback by Intent</h4>
            <p class="text-xs text-neutral-500 mt-1">Same metrics grouped by the classified intent for the message that was rated.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left text-neutral-600">
                  <th class="px-4 py-2 font-medium">Intent</th>
                  <th class="px-4 py-2 font-medium text-right"><span class="section-tip" data-tip="Count of feedback entries for this intent.">Total</span></th>
                  <th class="px-4 py-2 font-medium text-right">üëç</th>
                  <th class="px-4 py-2 font-medium text-right">üëé</th>
                  <th class="px-4 py-2 font-medium text-right"><span class="section-tip" data-tip="(üëç √∑ Total) √ó 100 for this intent.">Rate</span></th>
                </tr>
              </thead>
              <tbody id="feedback-by-intent-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- By Tier Table -->
        <div class="bg-white rounded-2xl border overflow-hidden">
          <div class="bg-neutral-50 px-4 py-3 border-b">
            <h4 class="font-semibold text-neutral-700 text-sm">Feedback by Tier</h4>
            <p class="text-xs text-neutral-500 mt-1">T1=regex, T2=fuzzy, T3=semantic, T4=LLM classify, T5=LLM reply. Shows which tier produced the response that was rated.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left text-neutral-600">
                  <th class="px-4 py-2 font-medium">Tier</th>
                  <th class="px-4 py-2 font-medium text-right">Total</th>
                  <th class="px-4 py-2 font-medium text-right">üëç</th>
                  <th class="px-4 py-2 font-medium text-right">üëé</th>
                  <th class="px-4 py-2 font-medium text-right">Rate</th>
                </tr>
              </thead>
              <tbody id="feedback-by-tier-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Recent Feedback -->
        <div class="bg-white rounded-2xl border overflow-hidden">
          <div class="bg-neutral-50 px-4 py-3 border-b">
            <h4 class="font-semibold text-neutral-700 text-sm">Recent Feedback (Last 20)</h4>
            <p class="text-xs text-neutral-500 mt-1">Latest 20 feedback rows from the database, newest first. No date filter applied.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left text-neutral-600">
                  <th class="px-4 py-2 font-medium">Time</th>
                  <th class="px-4 py-2 font-medium">Phone</th>
                  <th class="px-4 py-2 font-medium">Intent</th>
                  <th class="px-4 py-2 font-medium">Tier</th>
                  <th class="px-4 py-2 font-medium text-center">Rating</th>
                </tr>
              </thead>
              <tbody id="feedback-recent-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Loading State -->
        <div id="feedback-loading" class="hidden bg-white rounded-2xl border p-8 text-center">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent mb-3"></div>
          <div class="text-neutral-700 font-medium">Loading feedback data...</div>
        </div>

        <!-- Empty State -->
        <div id="feedback-empty" class="hidden bg-white rounded-2xl border p-8 text-center">
          <div class="text-4xl mb-3">üìä</div>
          <div class="text-neutral-500 font-medium">No feedback data available</div>
          <div class="text-sm text-neutral-400 mt-1">Feedback will appear here as users interact with the bot</div>
        </div>
      </div>

      <!-- RIGHT COLUMN: Intent Accuracy -->
      <div class="space-y-4">
        <div class="flex items-center justify-between">
          <h3 class="text-base font-semibold text-neutral-700">Intent Classification Accuracy</h3>
          <button onclick="refreshIntentAccuracy()" class="text-xs bg-neutral-100 hover:bg-neutral-200 text-neutral-700 px-3 py-1.5 rounded-lg transition font-medium">
            Refresh
          </button>
        </div>

        <!-- Overall Stats Cards -->
        <div id="intent-accuracy-overall-stats" class="grid grid-cols-2 gap-3">
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="intent-accuracy-total" class="text-2xl font-bold text-neutral-800">0</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Total rows in intent_predictions. Each row = one message that was classified and optionally validated by staff/guest."><span class="tip-icon">‚Ñπ</span> Total Predictions</span></div>
          </div>
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="intent-accuracy-correct" class="text-2xl font-bold text-green-600">0</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Predictions marked was_correct = true (validated as correct in Live Chat or Real Chat)."><span class="tip-icon">‚Ñπ</span> ‚úì Correct</span></div>
          </div>
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="intent-accuracy-incorrect" class="text-2xl font-bold text-red-500">0</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Predictions marked was_correct = false (staff or correction flow said the intent was wrong)."><span class="tip-icon">‚Ñπ</span> ‚úó Incorrect</span></div>
          </div>
          <div class="bg-white rounded-2xl border p-4 text-center">
            <div id="intent-accuracy-rate" class="text-2xl font-bold text-primary-500">0%</div>
            <div class="text-xs text-neutral-500 mt-1"><span class="section-tip" data-tip="Correct √∑ (Correct + Incorrect) √ó 100. Only validated predictions count; unvalidated rows are excluded."><span class="tip-icon">‚Ñπ</span> Accuracy Rate</span></div>
          </div>
        </div>

        <!-- Accuracy by Intent Table -->
        <div class="bg-white rounded-2xl border overflow-hidden">
          <div class="bg-neutral-50 px-4 py-3 border-b">
            <h4 class="font-semibold text-neutral-700 text-sm">Accuracy by Intent</h4>
            <p class="text-xs text-neutral-500 mt-1">Accuracy and confidence grouped by predicted intent. Conf = average confidence (0‚Äì1) for that intent.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left text-neutral-600">
                  <th class="px-4 py-2 font-medium">Intent</th>
                  <th class="px-4 py-2 font-medium text-right">Total</th>
                  <th class="px-4 py-2 font-medium text-right">‚úì</th>
                  <th class="px-4 py-2 font-medium text-right">‚úó</th>
                  <th class="px-4 py-2 font-medium text-right"><span class="section-tip" data-tip="Correct √∑ validated count √ó 100 for this intent.">Rate</span></th>
                  <th class="px-4 py-2 font-medium text-right"><span class="section-tip" data-tip="Average confidence score (0‚Äì1) of the classifier for this intent.">Conf</span></th>
                </tr>
              </thead>
              <tbody id="intent-accuracy-by-intent-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Accuracy by Tier Table -->
        <div class="bg-white rounded-2xl border overflow-hidden">
          <div class="bg-neutral-50 px-4 py-3 border-b">
            <h4 class="font-semibold text-neutral-700 text-sm">Accuracy by Tier</h4>
            <p class="text-xs text-neutral-500 mt-1">Which classification tier (T1‚ÄìT5) produced the prediction. Helps see if regex/fuzzy/semantic/LLM are more often correct.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left text-neutral-600">
                  <th class="px-4 py-2 font-medium">Tier</th>
                  <th class="px-4 py-2 font-medium text-right">Total</th>
                  <th class="px-4 py-2 font-medium text-right">‚úì</th>
                  <th class="px-4 py-2 font-medium text-right">‚úó</th>
                  <th class="px-4 py-2 font-medium text-right">Rate</th>
                  <th class="px-4 py-2 font-medium text-right">Conf</th>
                </tr>
              </thead>
              <tbody id="intent-accuracy-by-tier-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Accuracy by Model Table -->
        <div class="bg-white rounded-2xl border overflow-hidden">
          <div class="bg-neutral-50 px-4 py-3 border-b">
            <h4 class="font-semibold text-neutral-700 text-sm">Accuracy by LLM Model (T4 Only)</h4>
            <p class="text-xs text-neutral-500 mt-1">Only predictions where an LLM was used to classify (tier T4). Rows with model IS NOT NULL. Compare which provider (e.g. groq-llama-8b) performs best.</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left text-neutral-600">
                  <th class="px-4 py-2 font-medium">Model</th>
                  <th class="px-4 py-2 font-medium text-right">Total</th>
                  <th class="px-4 py-2 font-medium text-right">‚úì</th>
                  <th class="px-4 py-2 font-medium text-right">‚úó</th>
                  <th class="px-4 py-2 font-medium text-right">Rate</th>
                </tr>
              </thead>
              <tbody id="intent-accuracy-by-model-tbody"></tbody>
            </table>
          </div>
        </div>

        <!-- Loading State -->
        <div id="intent-accuracy-loading" class="hidden bg-white rounded-2xl border p-8 text-center">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary-500 border-t-transparent mb-3"></div>
          <div class="text-neutral-700 font-medium">Loading intent accuracy data...</div>
        </div>

        <!-- Empty State -->
        <div id="intent-accuracy-empty" class="hidden bg-white rounded-2xl border p-8 text-center">
          <div class="text-4xl mb-3">üéØ</div>
          <div class="text-neutral-500 font-medium">No intent accuracy data available</div>
          <div class="text-sm text-neutral-400 mt-1">Data will appear here as users validate intent predictions</div>
        </div>
      </div>
    </div>
